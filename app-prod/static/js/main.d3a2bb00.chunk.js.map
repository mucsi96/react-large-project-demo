{"version":3,"sources":["../../../../src/components/Button/Button.tsx","../../../../src/components/Spinner/Spinner.tsx","../../src/types.ts","../../../src/api/useApi.ts","../../src/friends.ts","../../../src/FriendsList/friendsReducer.ts","../../../src/FriendsList/FriendsList.tsx","../../../src/FriendsList/useFriends.ts","../../../src/api/fetchJSON.ts","App.tsx","index.tsx"],"names":["Button","children","disabled","primary","secondary","props","type","className","container","Spinner","FriendActions","useApi","callApi","fetcher","cache","noAbortOnSubsequentCall","apiState","setApiState","isLoading","abortController","mounted","current","abort","fetchData","async","fetchArgs","AbortController","payload","options","signal","data","err","error","name","result","Object","assign","fetch","getFriends","reference","searchText","href","_links","next","queryParams","processFriend","friend","action","method","updateFriend","state","id","update","friends","map","friendsReducer","_embedded","isFavorite","isProcessing","ADD_TO_FAVORITE","notifications","key","notificationKey","message","firstName","REMOVE_FROM_FAVORITE","filter","text","FriendsList","isEmpty","loadingErrorMessage","loadMore","addToFavorites","removeFromFavorites","search","processFriends","dispatch","Date","now","toString","setTimeout","length","response","status","undefined","useFriends","value","onChange","event","target","lastName","image","fullName","join","src","alt","actions","onClick","info","fetchJSON","headers","body","entries","reduce","params","set","URLSearchParams","paramsSeparator","includes","window","Boolean","JSON","stringify","textResult","parse","ok","App","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.d3a2bb00.chunk.js","sourcesContent":["import classNames from 'classnames';\r\nimport React, { FC } from 'react';\r\nimport styles from './Button.module.scss';\r\n\r\nexport type ButtonProps = {\r\n  disabled?: boolean;\r\n  /**\r\n   * Simple click handler\r\n   */\r\n  onClick?: () => void;\r\n\r\n  /**\r\n   * Is primary?\r\n   */\r\n  primary?: boolean;\r\n\r\n  /**\r\n   * default is false\r\n   */\r\n\r\n  secondary?: boolean;\r\n};\r\n\r\nexport const Button: FC<ButtonProps> = ({\r\n  children,\r\n  disabled,\r\n  primary,\r\n  secondary,\r\n  ...props\r\n}) => (\r\n  <button\r\n    {...props}\r\n    type=\"button\"\r\n    className={classNames(styles.container, {\r\n      [styles.primary]: primary,\r\n      [styles.secondary]: secondary,\r\n      [styles.disabled]: disabled,\r\n    })}\r\n    disabled={disabled}\r\n  >\r\n    {children}\r\n  </button>\r\n);\r\n","import React, { FC } from 'react';\r\nimport styles from './Spinner.module.scss';\r\n\r\nexport const Spinner: FC = (props) => (\r\n  <div {...props} className={styles.container}>\r\n    <div></div>\r\n    <div></div>\r\n    <div></div>\r\n    <div></div>\r\n    <div></div>\r\n  </div>\r\n);\r\n","import { ApiMethod } from 'core';\r\n\r\nexport type Link = {\r\n  href: string;\r\n  method?: ApiMethod;\r\n};\r\n\r\nexport type Friend = {\r\n  id: string;\r\n  firstName: string;\r\n  lastName: string;\r\n  image: string;\r\n  isFavorite: boolean;\r\n  _links: Record<FriendActions, Link>;\r\n};\r\n\r\nexport type FriendsResponse = {\r\n  _embedded: Friend[];\r\n  _links: {\r\n    next?: Link;\r\n  };\r\n};\r\n\r\nexport enum FriendActions {\r\n  ADD_TO_FAVORITE = 'addToFavorite',\r\n  REMOVE_FROM_FAVORITE = 'removeFromFavorite',\r\n}\r\n","import { useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { ApiCaller, ApiError, ApiState, CallApiOptions } from './types';\r\n\r\nexport type Fetcher<FetchArgs extends unknown[], ResponseBody> = (\r\n  callApi: ApiCaller,\r\n  ...args: FetchArgs\r\n) => Promise<ResponseBody>;\r\n\r\nexport type UseApiResult<FetchArgs extends unknown[], ResponseBody> = {\r\n  fetch: (...args: FetchArgs) => void;\r\n  data?: ResponseBody;\r\n  error?: ApiError;\r\n  isLoading: boolean;\r\n  fetchArgs?: FetchArgs;\r\n};\r\n\r\nexport type UseApiOptions = {\r\n  cache?: boolean;\r\n  noAbortOnSubsequentCall?: boolean;\r\n};\r\n\r\nexport function useApi<FetchArgs extends unknown[], ResponseBody>(\r\n  callApi: ApiCaller,\r\n  fetcher: Fetcher<FetchArgs, ResponseBody>,\r\n  { cache, noAbortOnSubsequentCall }: UseApiOptions = {}\r\n): UseApiResult<FetchArgs, ResponseBody> {\r\n  const [apiState, setApiState] = useState({\r\n    isLoading: false,\r\n  } as ApiState<FetchArgs, ResponseBody>);\r\n  const abortController = useRef<AbortController>();\r\n  const mounted = useRef(true);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      mounted.current = false;\r\n      abortController.current?.abort();\r\n    };\r\n  }, []);\r\n\r\n  const fetchData = useCallback(\r\n    async (...fetchArgs: FetchArgs) => {\r\n      if (!noAbortOnSubsequentCall) {\r\n        abortController.current?.abort();\r\n      }\r\n\r\n      try {\r\n        abortController.current = new AbortController();\r\n        setApiState({\r\n          isLoading: true,\r\n        });\r\n        const payload = await fetcher(\r\n          (options: CallApiOptions) =>\r\n            callApi({\r\n              ...options,\r\n              cache,\r\n              signal: abortController.current?.signal,\r\n            }),\r\n          ...fetchArgs\r\n        );\r\n        setApiState({\r\n          isLoading: false,\r\n          data: payload,\r\n          fetchArgs: fetchArgs,\r\n        });\r\n      } catch (err) {\r\n        const error = err as ApiError & { name: string };\r\n\r\n        if (error.name !== 'AbortError') {\r\n          setApiState({\r\n            isLoading: false,\r\n            error: error,\r\n            fetchArgs: fetchArgs,\r\n          });\r\n        } else if (mounted.current) {\r\n          setApiState({\r\n            isLoading: false,\r\n            fetchArgs: fetchArgs,\r\n          });\r\n        }\r\n      }\r\n    },\r\n    [fetcher, abortController, callApi, cache, noAbortOnSubsequentCall]\r\n  );\r\n\r\n  const result = useMemo(() => ({}), []);\r\n\r\n  return Object.assign(result, apiState, { fetch: fetchData });\r\n}\r\n","import { ApiCaller } from 'core';\r\nimport { Friend, FriendsResponse, FriendActions } from './types';\r\n\r\nexport type GetFriendsOptions = {\r\n  reference?: FriendsResponse;\r\n  searchText?: string;\r\n};\r\n\r\nexport async function getFriends(\r\n  callApi: ApiCaller,\r\n  { reference, searchText }: GetFriendsOptions = {}\r\n): Promise<FriendsResponse> {\r\n  const friends = (await callApi({\r\n    href: reference?._links.next?.href ?? '/api/friends',\r\n    ...(searchText && { queryParams: { searchText } }),\r\n  })) as FriendsResponse;\r\n  return friends;\r\n}\r\n\r\nexport function hasMore(reference: FriendsResponse): boolean {\r\n  return !!reference._links.next;\r\n}\r\n\r\nexport type ProcessFriendOptions = {\r\n  friend: Friend;\r\n  action: FriendActions;\r\n};\r\n\r\nexport async function processFriend(\r\n  callApi: ApiCaller,\r\n  { friend, action }: ProcessFriendOptions\r\n): Promise<void> {\r\n  const { href, method } = friend._links[action];\r\n  await callApi({ href, method });\r\n}\r\n","import { FriendActions } from 'friends-api';\r\nimport { FriendsAction, FriendsState, Friend } from './types';\r\n\r\nfunction updateFriend(\r\n  state: FriendsState,\r\n  id: string,\r\n  update: Partial<Friend>\r\n) {\r\n  return {\r\n    ...state,\r\n    friends: state.friends.map((friend) => {\r\n      if (friend.id !== id) {\r\n        return friend;\r\n      }\r\n\r\n      return {\r\n        ...friend,\r\n        ...update,\r\n      };\r\n    }),\r\n  };\r\n}\r\n\r\nexport function friendsReducer(\r\n  state: FriendsState,\r\n  action: FriendsAction\r\n): FriendsState {\r\n  switch (action.type) {\r\n    case 'LOAD_FRIENDS':\r\n      return {\r\n        ...state,\r\n        friends: [...state.friends, ...action.payload._embedded],\r\n      };\r\n    case 'ADD_TO_FAVORITES':\r\n      return updateFriend(state, action.id, {\r\n        isFavorite: true,\r\n        isProcessing: true,\r\n      });\r\n    case 'REMOVE_FROM_FAVORITES':\r\n      return updateFriend(state, action.id, {\r\n        isFavorite: false,\r\n        isProcessing: true,\r\n      });\r\n    case 'PROCESSING_SUCCEED':\r\n      return updateFriend(state, action.friend.id, {\r\n        isProcessing: false,\r\n      });\r\n    case 'PROCESSING_FAILED':\r\n      switch (action.action) {\r\n        case FriendActions.ADD_TO_FAVORITE:\r\n          return {\r\n            ...updateFriend(state, action.friend.id, {\r\n              isProcessing: false,\r\n              isFavorite: false,\r\n            }),\r\n            notifications: [\r\n              {\r\n                key: action.notificationKey,\r\n                message: `Adding ${action.friend.firstName} to favorite was not successful`,\r\n              },\r\n              ...state.notifications,\r\n            ],\r\n          };\r\n        case FriendActions.REMOVE_FROM_FAVORITE:\r\n          return {\r\n            ...updateFriend(state, action.friend.id, {\r\n              isProcessing: false,\r\n              isFavorite: true,\r\n            }),\r\n            notifications: [\r\n              {\r\n                key: action.notificationKey,\r\n                message: `Removing ${action.friend.firstName} from favorite was not successful`,\r\n              },\r\n              ...state.notifications,\r\n            ],\r\n          };\r\n        default:\r\n          return state;\r\n      }\r\n    case 'CLEAR_NOTIFICATION':\r\n      return {\r\n        ...state,\r\n        notifications: state.notifications.filter(\r\n          ({ key }) => key !== action.key\r\n        ),\r\n      };\r\n    case 'SEARCH':\r\n      return {\r\n        ...state,\r\n        searchText: action.text,\r\n        friends: [],\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n","import { ApiCaller, Button, Spinner } from 'core';\r\nimport React, { FC } from 'react';\r\nimport styles from './FriendsList.module.scss';\r\nimport { useFriends } from './useFriends';\r\n\r\nexport const FriendsList: FC<{ callApi: ApiCaller }> = ({ callApi }) => {\r\n  const {\r\n    friends = [],\r\n    isLoading,\r\n    isEmpty,\r\n    loadingErrorMessage,\r\n    searchText,\r\n    loadMore,\r\n    addToFavorites,\r\n    removeFromFavorites,\r\n    notifications,\r\n    search,\r\n  } = useFriends(callApi);\r\n\r\n  return (\r\n    <div data-name=\"friend-list\" className={styles.container}>\r\n      <input\r\n        type=\"text\"\r\n        value={searchText}\r\n        onChange={(event) => search(event.target.value)}\r\n      />\r\n      {!!notifications.length && (\r\n        <div data-name=\"notifications\" className={styles.notifications}>\r\n          {notifications.map(({ key, message }) => (\r\n            <p key={key} className={styles.error}>\r\n              {message}\r\n            </p>\r\n          ))}\r\n        </div>\r\n      )}\r\n      {friends.map((friend) => {\r\n        const { id, firstName, lastName, image } = friend;\r\n        const fullName = [firstName, lastName].join(' ');\r\n        return (\r\n          <div key={id} data-name=\"friend\" className={styles.friend}>\r\n            <img src={image} alt={fullName} />\r\n            <span data-name=\"full-name\">{fullName}</span>\r\n            <div className={styles.actions}>\r\n              {!friend.isFavorite && (\r\n                <Button\r\n                  primary\r\n                  onClick={() => addToFavorites(friend)}\r\n                  data-name=\"add-to-favorite\"\r\n                  disabled={friend.isProcessing}\r\n                >\r\n                  Add to favorite\r\n                </Button>\r\n              )}\r\n              {friend.isFavorite && (\r\n                <Button\r\n                  secondary\r\n                  onClick={() => removeFromFavorites(friend)}\r\n                  data-name=\"remove-from-favorite\"\r\n                  disabled={friend.isProcessing}\r\n                >\r\n                  Remove from favorite\r\n                </Button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        );\r\n      })}\r\n      {(() => {\r\n        if (isLoading) {\r\n          return <Spinner />;\r\n        }\r\n\r\n        if (loadingErrorMessage) {\r\n          return (\r\n            <span data-name=\"message\" className={styles.error}>\r\n              {loadingErrorMessage}\r\n            </span>\r\n          );\r\n        }\r\n\r\n        if (isEmpty) {\r\n          return (\r\n            <span data-name=\"message\" className={styles.info}>\r\n              {'No friends found :('}\r\n            </span>\r\n          );\r\n        }\r\n\r\n        if (loadMore) {\r\n          return (\r\n            <div className={styles.loadMore}>\r\n              <Button secondary onClick={loadMore} data-name=\"load-more\">\r\n                Load more...\r\n              </Button>\r\n            </div>\r\n          );\r\n        }\r\n      })()}\r\n    </div>\r\n  );\r\n};\r\n","import { useApi, ApiCaller } from 'core';\r\nimport { getFriends, processFriend, FriendActions, hasMore } from 'friends-api';\r\nimport { useEffect, useReducer } from 'react';\r\nimport { friendsReducer } from './friendsReducer';\r\nimport { Notification, Friend } from './types';\r\n\r\nexport function useFriends(\r\n  callApi: ApiCaller\r\n): {\r\n  friends?: Friend[];\r\n  isLoading: boolean;\r\n  isEmpty: boolean;\r\n  loadingErrorMessage?: string;\r\n  searchText: string;\r\n  loadMore?: () => void;\r\n  addToFavorites: (friend: Friend) => void;\r\n  removeFromFavorites: (friend: Friend) => void;\r\n  notifications: Notification[];\r\n  search: (text: string) => void;\r\n} {\r\n  const friends = useApi(callApi, getFriends);\r\n  const processFriends = useApi(callApi, processFriend, {\r\n    noAbortOnSubsequentCall: true,\r\n  });\r\n  const [state, dispatch] = useReducer(friendsReducer, {\r\n    friends: [],\r\n    notifications: [],\r\n    searchText: '',\r\n  });\r\n\r\n  useEffect(() => {\r\n    friends.fetch({ searchText: state.searchText });\r\n  }, [friends, state.searchText]);\r\n\r\n  useEffect(() => {\r\n    if (friends.data) {\r\n      dispatch({ type: 'LOAD_FRIENDS', payload: friends.data });\r\n    }\r\n  }, [friends.data]);\r\n\r\n  useEffect(() => {\r\n    if (!processFriends.fetchArgs) {\r\n      return;\r\n    }\r\n\r\n    const [{ friend, action }] = processFriends.fetchArgs;\r\n    const notificationKey = Date.now().toString();\r\n    dispatch({\r\n      type: processFriends.error ? 'PROCESSING_FAILED' : 'PROCESSING_SUCCEED',\r\n      friend,\r\n      action,\r\n      notificationKey,\r\n    });\r\n    setTimeout(\r\n      () => dispatch({ type: 'CLEAR_NOTIFICATION', key: notificationKey }),\r\n      3000\r\n    );\r\n  }, [processFriends.data, processFriends.error, processFriends.fetchArgs]);\r\n\r\n  return {\r\n    friends: state.friends,\r\n    isLoading: friends.isLoading,\r\n    isEmpty: friends.data ? !state.friends.length : false,\r\n    loadingErrorMessage:\r\n      friends.error &&\r\n      `${friends.error.response?.error?.message ?? ''} Status: ${\r\n        friends.error.status ?? ''\r\n      }`,\r\n    searchText: state.searchText,\r\n    loadMore:\r\n      friends.data && hasMore(friends.data)\r\n        ? () =>\r\n            friends.fetch({\r\n              reference: friends.data,\r\n              searchText: state.searchText,\r\n            })\r\n        : undefined,\r\n    addToFavorites: (friend: Friend) => {\r\n      dispatch({ type: 'ADD_TO_FAVORITES', id: friend.id });\r\n      processFriends.fetch({ friend, action: FriendActions.ADD_TO_FAVORITE });\r\n    },\r\n    removeFromFavorites: (friend: Friend) => {\r\n      dispatch({ type: 'REMOVE_FROM_FAVORITES', id: friend.id });\r\n      processFriends.fetch({\r\n        friend,\r\n        action: FriendActions.REMOVE_FROM_FAVORITE,\r\n      });\r\n    },\r\n    notifications: state.notifications,\r\n    search: (text: string) => dispatch({ type: 'SEARCH', text }),\r\n  };\r\n}\r\n","import { ApiError, ApiErrorResponse, CallApiOptions } from './types';\r\n\r\nexport async function fetchJSON<ResponseBody>({\r\n  href,\r\n  queryParams = {},\r\n  method,\r\n  headers,\r\n  body,\r\n  signal,\r\n}: CallApiOptions): Promise<ResponseBody> {\r\n  const search = Object.entries(queryParams)\r\n    .reduce((params, [key, value]) => {\r\n      params.set(key, value);\r\n      return params;\r\n    }, new URLSearchParams())\r\n    .toString();\r\n  const paramsSeparator = href.includes('?') ? '&' : '?';\r\n  const response = await window.fetch(\r\n    [href, search].filter(Boolean).join(paramsSeparator),\r\n    {\r\n      ...(method && { method }),\r\n      headers: {\r\n        ...headers,\r\n        'Content-Type': 'application/json',\r\n      },\r\n      ...(body ? { body: JSON.stringify(body) } : {}),\r\n      ...(signal && { signal }),\r\n    }\r\n  );\r\n\r\n  const textResult = await response.text();\r\n  const result = (textResult ? JSON.parse(textResult) : null) as ResponseBody;\r\n\r\n  if (!response.ok) {\r\n    // eslint-disable-next-line no-throw-literal\r\n    throw {\r\n      message: 'Failed to fetch data',\r\n      response: result as ApiErrorResponse,\r\n      status: response.status,\r\n    } as ApiError;\r\n  }\r\n\r\n  return result;\r\n}\r\n","import React, { FC } from 'react';\r\nimport { FriendsList } from 'friends';\r\nimport { fetchJSON } from 'core';\r\n\r\nimport './App.css';\r\n\r\nconst App: FC = () => <FriendsList callApi={fetchJSON} />;\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport { setMockApiDelay } from 'mock-api';\r\nimport { setupWorker } from 'msw';\r\nimport { mockFriendHandlers } from 'friends-api';\r\n\r\nimport './index.css';\r\n\r\nif (process.env.REACT_APP_USE_MOCK_API === 'true') {\r\n  const worker = setupWorker(...mockFriendHandlers);\r\n  // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n  worker.start();\r\n  setMockApiDelay(750);\r\n}\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}